---
title: "Hedge & Safe Haven Testing with HedgeSafeHaven"
author: "Jawad Shahzad"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    df_print: paged
vignette: >
  %\VignetteIndexEntry{Hedge & Safe Haven Testing with HedgeSafeHaven}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: references.bib
---

knitr::opts_chunk$set(message = FALSE, warning = FALSE)

# Hedge and Safe Haven Testning

The package/repo is developed to test hedge and safe haven hypotheses [@baur2010], estimate the hedge ratio, hedge effectiveness, and optimal portfolio weights [@basher2016], cross-quantilogram-based predictability [@han2016] and the conditional diversification benefits [@christoffersen2012; @christoffersen2018].

## Background & Motivation

The role of assets such as **gold** and **bitcoin** as potential hedges or safe havens for equity markets has attracted increasing scholarly attention (e.g., @ali2020; @shahzad2019; @shahzad2020; @mujtaba2024) amid heightened global economic uncertainty, persistent inflationary pressures, and evolving monetary policy regimes.


## Market Context (as of late 2025)

- **Gold** has surged to record highs above **$4,000 per ounce**, driven by central-bank purchases and portfolio diversification away from fiat currencies.  
  ([BeInCrypto, 2025](https://beincrypto.com/gold-all-time-high-bitcoin-rally/?utm_source=chatgpt.com))
- **Bitcoin** climbed above **$110,000** amid U.S. dollar weakness and renewed “digital-gold” narratives.  
  ([Forbes, 2025](https://www.forbes.com/sites/digital-assets/2025/10/07/serious-us-dollar-fed-warning-triggers-sudden-bitcoin-and-gold-all-time-high-price-surge/?utm_source=chatgpt.com))
- Short-term divergences have appeared — gold rallies while bitcoin retreats — highlighting their differing safe-haven mechanisms.  
  ([CoinDesk, 2025](https://www.coindesk.com/markets/2025/09/22/gold-rallies-an-hour-after-bitcoin-drops-suggesting-a-profit-rotation-into-metals?utm_source=chatgpt.com))

The **HedgeSafeHaven** package provides econometric tools to quantify such behaviors using **GARCH–DCC**, **regression-based safe-haven models**, **cross-quantile dependence**, and **conditional diversification benefits (CDB)**.

---

## Example Workflow — Gold and Bitcoin

We illustrate how to use **gold (GLD)** and **bitcoin (BTC)** as potential hedges or safe havens for the **U.S. stock market (S&P 500)**.


### 1️⃣ Hedge / Safe-Haven Classification

```{r hedge-safehaven, message=FALSE, warning=FALSE}
library(HedgeSafeHaven)
# Regression-based hedge/safe-haven estimation
# SP500 and Gold
data("hedgedata")
res_gld <- hedge_safehaven_bm10(hedgedata$SP, hedgedata$GLD)
print(res_gld)
# SP500 and Gold
res_btc <- hedge_safehaven_bm10(hedgedata$SP, hedgedata$BTC)
print(res_btc)

# Classification
classify_bm10(res_gld)
classify_bm10(res_btc)
```

This classifies gold/bitcoin role as a hedge or safe haven relative to sp500 using the @baur2010 approach.

### 2️⃣ Hedge Effectiveness via DCC

```{r hedge-effectiveness, message=FALSE, warning=FALSE}
# Hedging asset: Gold
res_gld <- hedge_effectiveness_dcc(hedgedata$SP, hedgedata$GLD)
print(res_gld)

# Hedged asset: Bitcoin, 
res_btc <- hedge_effectiveness_dcc(hedgedata$SP, hedgedata$BTC)
print(res_btc)

```

### 3️⃣ Cross-Quantile Dependence Heatmaps

```{r cq1, message=FALSE, warning=FALSE}
## Install the 'quantilogram' library
# install.packages("quantilogram") 
library(quantilogram)
# Use gold (GLD) as predicted variable, S&P (SP) as predicting variable
df1 <- hedgedata[, c("GLD", "SP")]
## setup and estimation 
k = 1                             ## lag order 
vec.q  = seq(0.05, 0.95, 0.05)    ## a list of quantiles 
B.size = 100                      ## Repetition of bootstrap  
res1 = crossq.heatmap(df1, k, vec.q, B.size, var1_name = "Gold", var2_name = "SP500") 

## result 
print(res1$plot)
```

```{r cq2, message=FALSE, warning=FALSE}
# Use bitcoin (BTC) as predicted variable, S&P (SP) as predicting variable
df2 <- hedgedata[, c("BTC", "SP")]
res2 = crossq.heatmap(df2, k, vec.q, B.size, var1_name = "Bitcoin", var2_name = "SP500") 

## result 
print(res2$plot)

```

These heatmaps visualize how dependence across quantiles changes from S&P 500 to gold and bitcoin — revealing whether gold/bitcoin remains uncorrelated or negatively correlated (safe haven) during market stress.

### 4️⃣ Conditional Diversification Benefit (CDB)

```{r cross-quantilogram, message=FALSE, warning=FALSE}
# Compute CDB for SP500–Gold portfolio at 5% tail
res_cdb1 <- cdb(hedgedata$SP, hedgedata$GLD, p = 0.05, w = 0.10)
print(res_cdb1)

# Compute CDB for SP500–Bitcoin portfolio at 5% tail
res_cdb2 <- cdb(hedgedata$SP, hedgedata$GLD, p = 0.05, w = 0.10)
print(res_cdb2)
```

This returns a 1×3 matrix of CDB values for portfolio weights of 5%, 10%, and 20% in the hedging asset (gold/bitcoin).
Higher CDB values imply stronger diversification benefits w.r.t weights.
